-- SINGLE USE CASE LISTAGG
SELECT LISTAGG(NAME,',') WITHIN GROUP (ORDER BY NAME) NAMA
FROM EMP_HR
WHERE NIK IS NOT NULL

-- EXAMPLE LISTAGG GROUPING BY JOB DESC
SELECT COUNT(*), LISTAGG(NAME,',') WITHIN GROUP (ORDER BY JOB_DESC) NAMA, JOB_DESC
FROM EMP_HR
WHERE NIK IS NOT NULL
GROUP BY JOB_DESC

--LISTAGG HAVING
SELECT COUNT(*), LISTAGG(NAME,',') WITHIN GROUP (ORDER BY JOB_DESC) NAMA, JOB_DESC
FROM EMP_HR
WHERE NIK IS NOT NULL
GROUP BY JOB_DESC
HAVING LISTAGG(NAME,',') <> 'JOHN'

-- EXAMPLE LISTAGG GROUPING BY JOB DESC AND SALARY
SELECT COUNT(*), LISTAGG(NAME,',') WITHIN GROUP (ORDER BY NAME) NAMA, JOB_DESC, SALARY
FROM EMP_HR
WHERE NIK IS NOT NULL
GROUP BY JOB_DESC,SALARY

-- EXAMPLE LISTAGG
-- THIS WILL GIVE INFO: THAT THE CASHIER HAVE BEEN SEVERAL TIMES SERVE "TABLE_ID"
-- AND WORK AT MACHINE "POS_ID",
-- AND GROUP THE NAME INTO THE LISTAGG
SELECT 
    COUNT(*), 
    LISTAGG(HR.NAME,',') WITHIN GROUP (ORDER BY NAME) NAMA, 
    CMO.TABLE_ID, 
    PR.POS_ID
FROM EMP_HR HR
JOIN CASHIER_POS_RECORD PR
    ON HR.ID=PR.CASHIER_ID,
CUST_MAST_ORDER CMO
GROUP BY CMO.TABLE_ID, PR.POS_ID