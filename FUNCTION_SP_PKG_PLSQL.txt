--FUNCTION--
CREATE OR REPLACE Function FN_GET_CASHIER_ID( 
    P_NAME IN VARCHAR2 
)
   RETURN NUMERIC
AS
   V_HR_ID NUMERIC;

   CURSOR V_CURSOR IS
   SELECT DISTINCT HR.ID
     FROM EMP_HR HR
     JOIN CASHIER_POS_RECORD CPR
        ON HR.ID=CPR.CASHIER_ID
     WHERE HR.NAME = P_NAME;

BEGIN

   open V_CURSOR;
   FETCH V_CURSOR into V_HR_ID;

   if V_CURSOR%notfound then
      V_HR_ID := NULL;
   end if;

   close V_CURSOR;

RETURN V_HR_ID;

EXCEPTION
WHEN OTHERS THEN
   raise_application_error(-20001,'An error was encountered - '||SQLCODE||' -ERROR- '||SQLERRM);
END;

--SP--
create or replace PROCEDURE USP_GET_DETAIL_INVENT(
    P_NAME IN VARCHAR2,
    P_CUR OUT SYS_REFCURSOR
)AS
    V_TYP TYP_INFO_CHECK_CASHIER;
BEGIN
    OPEN P_CUR FOR 
        SELECT DISTINCT
            D.INVT_NAME, 
            I.SECTOR_NAME,
            d.purchased_at
        FROM REST_DETAIL_INFO I
        JOIN REST_DETAIL_INVENTORY D
            ON I.ID= D.SECTOR_ID
        JOIN CASHIER_POS_RECORD CPR
            ON CPR.POS_ID=D.ID
        WHERE
            CPR.CASHIER_ID=NVL(FN_GET_CASHIER_ID(P_NAME),CPR.CASHIER_ID)
--    OFFSET 10 ROWS FETCH NEXT 10 ROWS ONLY;
    FETCH NEXT 10 ROWS ONLY;
END;


-- VARIANT SELECT FETCH AND INSERT ALL
CREATE TABLE ROWNUM_ORDER_TEST(
    VAL NUMBER
)

INSERT ALL
    INTO ROWNUM_ORDER_TEST
SELECT LEVEL
FROM DUAL
CONNECT BY LEVEL <=10;
COMMIT;

INSERT ALL
    WHEN
        ID<=10 THEN
    INTO ROWNUM_ORDER_TEST1 VALUES(ID)
    WHEN
        ID>10 THEN
    INTO ROWNUM_ORDER_TEST VALUES(ID)
SELECT LEVEL ID
FROM DUAL
CONNECT BY LEVEL <=22;
COMMIT;

SELECT val
FROM   rownum_order_test
ORDER BY val DESC
FETCH FIRST 5 ROWS ONLY;

SELECT val
FROM   rownum_order_test
ORDER BY val DESC
FETCH FIRST 5 ROWS WITH TIES;

SELECT val
FROM   rownum_order_test
ORDER BY val
FETCH FIRST 20 PERCENT ROWS ONLY;

SELECT VAL, ROWNUM
FROM rownum_order_test ORDER BY VAL DESC


--PACKAGES--
CREATE OR REPLACE PACKAGE PKG_RESTAURANT IS
    FUNCTION FN_GET_ORDERED_FOOD(FOOD_ID NUMERIC) RETURN VARCHAR2;
    PROCEDURE USP_GET_CASHIER (P_NIK NUMERIC, P_ID OUT NUMERIC, P_NAME OUT VARCHAR2);
END PKG_RESTAURANT;

CREATE OR REPLACE PACKAGE BODY PKG_RESTAURANT IS
    --FUNCTION IMPLEMENTATION
    FUNCTION FN_GET_ORDERED_FOOD(FOOD_ID NUMERIC)
    RETURN VARCHAR2 
    IS
        V_FOOD_NAME VARCHAR2(50);
    BEGIN
        SELECT 
            NAME INTO V_FOOD_NAME
        FROM FOOD_BEVERAGES_INFO
        WHERE ID=4;
        
        RETURN V_FOOD_NAME;
    END FN_GET_ORDERED_FOOD;
    
    -- SP IMPLEMENTATION--
    PROCEDURE USP_GET_CASHIER (P_NIK NUMERIC, P_ID OUT NUMERIC, P_NAME OUT VARCHAR2)
    IS
    BEGIN
        SELECT
            NAME,ID INTO P_NAME,P_ID
        FROM EMP_HR
        WHERE NIK=P_NIK;
    END USP_GET_CASHIER;
END PKG_RESTAURANT;

DECLARE
    V_ID NUMERIC;
    V_NAME VARCHAR2(100);
BEGIN
    DBMS_OUTPUT.PUT_LINE(PKG_RESTAURANT.FN_GET_ORDERED_FOOD(3));
--    EXECUTE (PKG_RESTAURANT.USP_GET_CASHIER(111111,V_ID,V_NAME));
--    DBMS_OUTPUT.PUT_LINE(V_ID);
END;